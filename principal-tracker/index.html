<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light" />

  <title>楽天証券CSV → 取得額（元本）遷移ビューア</title>
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="#">取得額（元本）遷移ビューア</a>
    </div>
  </nav>

  <main class="container my-4">
    <section class="card shadow-sm mb-4">
      <div class="card-body">
        <h1 class="h4 mb-3">
          楽天証券（国内株式）取引履歴 CSV を読み込んで、<span class="text-nowrap">取得額（元本）の遷移</span>を可視化します
        </h1>
        <div class="row g-3 align-items-center">
          <div class="col-12 col-md-7">
            <input class="form-control" id="csvFile" type="file" accept=".csv,text/csv" />
          </div>
          <div class="col-12 col-md-5 d-flex gap-2">
            <button id="btnParse" class="btn btn-primary" disabled>
              読み込む
            </button>
            <button id="btnExport" class="btn btn-outline-secondary" disabled>
              CSVを書き出し
            </button>
          </div>
        </div>
        <p class="text-muted mt-2 small">
          対応カラム（例）：「受渡日 /
          約定日」「売買区分（買付・売付）」「数量［株］」「単価［円］」「手数料［円］」「税金等［円］」「受渡金額［円］」「銘柄コード
          / 銘柄名」<br />
          取得額（元本）は
          <span class="fw-semibold">総平均法（移動平均法）</span>
          で算出します（売付時は平均取得単価×売却株数を元本から減算）。
        </p>
        <div id="alert" class="mt-2"></div>
      </div>
    </section>

    <section class="row g-3 mb-4" id="summaryRow" hidden>
      <div class="col-6 col-lg-3">
        <div class="card metric">
          <div class="card-body">
            <div class="label">開始日</div>
            <div class="value" id="mStart">-</div>
          </div>
        </div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="card metric">
          <div class="card-body">
            <div class="label">最終日</div>
            <div class="value" id="mEnd">-</div>
          </div>
        </div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="card metric">
          <div class="card-body">
            <div class="label">現在の取得額</div>
            <div class="value" id="mCurrent">-</div>
          </div>
        </div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="card metric">
          <div class="card-body">
            <div class="label">ピーク取得額</div>
            <div class="value" id="mPeak">-</div>
          </div>
        </div>
      </div>
    </section>

    <section class="card shadow-sm mb-4" id="chartCard" hidden>
      <div class="card-body">
        <h2 class="h5 mb-3">取得額（元本）遷移</h2>
        <canvas id="principalChart" height="90"></canvas>
      </div>
    </section>

    <section class="card shadow-sm mb-4" id="tableCard" hidden>
      <div class="card-body">
        <h2 class="h5 mb-3">取引ごとの推移（計算ログ）</h2>
        <div class="table-responsive">
          <table class="table table-sm table-striped align-middle">
            <thead>
              <tr>
                <th>受渡日</th>
                <th>約定日</th>
                <th>銘柄</th>
                <th>売買</th>
                <th class="text-end">数量</th>
                <th class="text-end">単価</th>
                <th class="text-end">受渡金額</th>
                <th class="text-end">売却原価</th>
                <th class="text-end">取引後 元本合計</th>
              </tr>
            </thead>
            <tbody id="txBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <footer class="text-center text-muted small my-4">
      <p class="mb-0">
        © 2025 元本遷移ビューア — GitHub Pages でそのまま公開可能な静的サイト
      </p>
    </footer>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" crossorigin="anonymous"></script>
  <script src="./app.js" defer></script>
</body>

</html>